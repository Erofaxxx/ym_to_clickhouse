# –ò—Ç–æ–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏: –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç `export_ym_simple.py`, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≥—Ä—É–∂–∞–µ—Ç –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –≤ ClickHouse **—Ç–æ–ª—å–∫–æ —Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ .ipynb notebooks**.

## –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç: `export_ym_simple.py`

**–ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—ã–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ **8 –ø–æ–ª–µ–π –¥–ª—è hits** –∏ **10 –ø–æ–ª–µ–π –¥–ª—è visits**
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã —Å –¥—Ä—É–≥–∏–º–∏ –∏–º–µ–Ω–∞–º–∏: `hits_simple` –∏ `visits_simple`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è **–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∫—É–ø–æ–∫ (Revenue –∏ Purchases) –∫–∞–∫ –≤ notebooks
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏ (‚úì, ‚ö†, ‚ùå)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–±–æ—Ä–æ—á–Ω–æ–π –≤—ã–≥—Ä—É–∑–∫–∏ (—Ç–æ–ª—å–∫–æ hits –∏–ª–∏ —Ç–æ–ª—å–∫–æ visits)

### 2. –í—ã–≥—Ä—É–∂–∞–µ–º—ã–µ –ø–æ–ª—è

**Hits (8 –ø–æ–ª–µ–π):**
```python
'ym:pv:browser'              ‚Üí Browser
'ym:pv:clientID'             ‚Üí ClientID
'ym:pv:date'                 ‚Üí EventDate
'ym:pv:dateTime'             ‚Üí EventTime
'ym:pv:deviceCategory'       ‚Üí DeviceCategory
'ym:pv:lastTrafficSource'    ‚Üí TraficSource
'ym:pv:operatingSystemRoot'  ‚Üí OSRoot
'ym:pv:URL'                  ‚Üí URL
```

**Visits (10 –ø–æ–ª–µ–π):**
```python
'ym:s:browser'               ‚Üí Browser
'ym:s:clientID'              ‚Üí ClientID
'ym:s:date'                  ‚Üí StartDate
'ym:s:dateTime'              ‚Üí StartTime
'ym:s:deviceCategory'        ‚Üí DeviceCategory
'ym:s:lastTrafficSource'     ‚Üí TraficSource
'ym:s:operatingSystemRoot'   ‚Üí OSRoot
'ym:s:purchaseID'            ‚Üí (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è)
'ym:s:purchaseRevenue'       ‚Üí Revenue + Purchases
'ym:s:startURL'              ‚Üí StartURL
```

### 3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü –≤ ClickHouse

**hits_simple:**
- Browser (String)
- ClientID (UInt64)
- EventDate (Date)
- EventTime (DateTime)
- DeviceCategory (String)
- TraficSource (String)
- OSRoot (String)
- URL (String)

**visits_simple:**
- Browser (String)
- ClientID (UInt64)
- StartDate (Date)
- StartTime (DateTime)
- DeviceCategory (String)
- TraficSource (String)
- OSRoot (String)
- Purchases (Int32) - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ purchaseRevenue
- Revenue (Double) - –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ purchaseRevenue
- StartURL (String)

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ–π

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è:

1. **–°–Ω–∞—á–∞–ª–∞** –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –≤–º–µ—Å—Ç–µ
2. **–ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ –æ—Ç–¥–µ–ª—å–Ω–æ
3. **–í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úì –í—Å–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã
   - ‚ö† –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã (–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏)
   - ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª–µ–π (–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω—ã —Ç—Ä–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞:

**README_SIMPLE.md** (8.9 KB)
- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
- –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ó–∞–ø—Ä–æ—Å—ã –∫ –¥–∞–Ω–Ω—ã–º
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

**COMPARISON.md** (7.6 KB)
- –î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤
- –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π
- –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

**config_simple.example.json**
- –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

**–û–±–Ω–æ–≤–ª—ë–Ω README.md**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–≤–æ–º —Å–∫—Ä–∏–ø—Ç–µ
- –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ —Å—Ç–∞—Ä—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º

| –ü–∞—Ä–∞–º–µ—Ç—Ä | load_ym_to_clickhouse.py | export_ym_simple.py |
|----------|--------------------------|---------------------|
| –ü–æ–ª–µ–π | ~36 | 8 + 10 |
| –¢–∞–±–ª–∏—Ü—ã | ym_visits | hits_simple, visits_simple |
| –ò—Å—Ç–æ—á–Ω–∏–∫–∏ | visits | hits + visits |
| –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö | –ë–æ–ª—å—à–æ–π | –ú–∞–ª–µ–Ω—å–∫–∏–π |
| –°–∫–æ—Ä–æ—Å—Ç—å | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ | –ë—ã—Å—Ç—Ä–µ–µ |
| –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```bash
# –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp config_simple.example.json config_simple.json
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å config_simple.json

# –í—ã–≥—Ä—É–∑–∏—Ç—å –≤—Å—ë (hits + visits)
python export_ym_simple.py --config config_simple.json

# –¢–æ–ª—å–∫–æ hits
python export_ym_simple.py --config config_simple.json --hits-only

# –¢–æ–ª—å–∫–æ visits
python export_ym_simple.py --config config_simple.json --visits-only
```

### –° –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
export YM_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω"
export YM_COUNTER_ID="–Ω–æ–º–µ—Ä_—Å—á—ë—Ç—á–∏–∫–∞"
export YM_START_DATE="2024-01-01"
export YM_END_DATE="2024-01-31"
export CH_HOST="https://clickhouse:8443"
export CH_USER="user"
export CH_PASS="password"
export CH_DATABASE="analytics"

python export_ym_simple.py
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

1. **üéØ –¢–æ—á–Ω–æ—Å—Ç—å** - –≤—ã–≥—Ä—É–∂–∞–µ—Ç —Ä–æ–≤–Ω–æ —Ç–µ –ø–æ–ª—è, —á—Ç–æ –≤ notebooks
2. **‚ö° –°–∫–æ—Ä–æ—Å—Ç—å** - –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö = –±—ã—Å—Ç—Ä–µ–µ –≤—ã–≥—Ä—É–∑–∫–∞
3. **üíæ –≠–∫–æ–Ω–æ–º–∏—è** - –º–µ–Ω—å—à–µ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ –∏ –≤ –ø–∞–º—è—Ç–∏
4. **‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è** - —Ç—â–∞—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
5. **üîç –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
6. **üìä –î–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞** - –∏ hits, –∏ visits (–≤ —Å—Ç–∞—Ä–æ–º —Ç–æ–ª—å–∫–æ visits)
7. **üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å notebooks

–°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ª–æ–≥–∏–∫—É –∏–∑:
- `1a. get_data_via_logs_api.ipynb` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- `2. upload_data_to_clickhouse.ipynb` - –∑–∞–≥—Ä—É–∑–∫–∞ –≤ ClickHouse

–î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç **–∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏** —Ç–µ–º, —á—Ç–æ –ø–æ–ª—É—á–∞—é—Ç—Å—è –≤ notebooks.

## –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT count() FROM hits_simple;
SELECT count() FROM visits_simple;

-- –¢—Ä–∞—Ñ–∏–∫ –ø–æ –±—Ä–∞—É–∑–µ—Ä–∞–º
SELECT Browser, count() as cnt
FROM hits_simple
GROUP BY Browser
ORDER BY cnt DESC
LIMIT 10;

-- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –ø–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º
SELECT
    DeviceCategory,
    count() as visits,
    sum(Purchases) as purchases,
    sum(Revenue) as revenue,
    (sum(Purchases) * 100.0 / count()) as conversion_rate
FROM visits_simple
GROUP BY DeviceCategory
ORDER BY conversion_rate DESC;
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ö–ª–∞—Å—Å `YMSimpleExporter` —Å —á—ë—Ç–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
- –û—Ç–¥–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- requests (API)
- pandas (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
- some_funcs (ClickHouse –∫–ª–∏–µ–Ω—Ç)

### –§–∞–π–ª—ã
- `export_ym_simple.py` (24.5 KB)
- `README_SIMPLE.md` (8.9 KB)
- `COMPARISON.md` (7.6 KB)
- `config_simple.example.json` (371 B)

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–°–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –Ω—É–∂–Ω–æ:

1. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ –∏ ClickHouse
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** —Å–º. `README_SIMPLE.md` –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
