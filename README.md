# Yandex Metrica to ClickHouse

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏ –≤ ClickHouse —Å –∫—Ä–∞—Å–∏–≤—ã–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π** - –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –ø–æ–ª—è –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞
‚úÖ **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Å—á–µ—Ç—á–∏–∫–æ–º –±–µ–∑ —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª–µ–π
‚úÖ **–ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å –ø–æ–¥—Å–∫–∞–∑–∫–∞–º–∏
‚úÖ **–ö—Ä–∞—Å–∏–≤—ã–π –≤—ã–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö** - —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∫–∞–∫ –≤ Jupyter Notebook
‚úÖ **–ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ macOS, Linux, Windows

## –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤–∫–ª—é—á–∞–µ—Ç —á–µ—Ç—ã—Ä–µ –≥–æ—Ç–æ–≤—ã—Ö Python-—Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã:

1. **export_ym_complete.py** üåü **–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** - –ø–æ–ª–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª–µ–π —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –æ—à–∏–±–æ–∫
   - ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å ClientID=0**
   - ‚úÖ –í—Å–µ ~40 –ø–æ–ª–µ–π –¥–ª—è visits, 8 –ø–æ–ª–µ–π –¥–ª—è hits
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–ø—É—Å–∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–ª–µ–π (–±–µ–∑ –æ—à–∏–±–æ–∫)
   - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –∫–æ–ª–æ–Ω–æ–∫
   - –¢–∞–±–ª–∏—Ü—ã: `hits_complete`, `visits_complete`
   - üìñ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](README_COMPLETE.md)

2. **export_ym_simple.py** - —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–ª–µ–π (–∫–∞–∫ –≤ .ipynb notebooks)
   - 8 –ø–æ–ª–µ–π –¥–ª—è hits, 10 –ø–æ–ª–µ–π –¥–ª—è visits
   - –¢–∞–±–ª–∏—Ü—ã: `hits_simple`, `visits_simple`
   - –ë—ã—Å—Ç—Ä–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –¥–ª—è –±–∞–∑–æ–≤–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
   - üìñ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](README_SIMPLE.md)

3. **load_ym_to_clickhouse.py** ‚ö†Ô∏è **–£–°–¢–ê–†–ï–õ** - —Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç —Å –ø—Ä–æ–±–ª–µ–º–æ–π ClientID=0
   - ‚ö†Ô∏è ClientID –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å 0 –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `export_ym_complete.py` –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ
   - üìñ [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](USAGE_GUIDE.md)

4. **query_clickhouse.py** - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ ClickHouse —Å –∫—Ä–∞—Å–∏–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º

üìä **–ü–æ–ª–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:** —Å–º. [COMPARISON.md](COMPARISON.md)

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `config.json` –Ω–∞ –æ—Å–Ω–æ–≤–µ `config.example.json`:

```bash
cp config.example.json config.json
```

–ó–∞–ø–æ–ª–Ω–∏—Ç–µ `config.json` —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- `ym_token` - OAuth —Ç–æ–∫–µ–Ω –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
- `ym_counter_id` - ID —Å—á–µ—Ç—á–∏–∫–∞
- `start_date` / `end_date` - –ø–µ—Ä–∏–æ–¥ –≤—ã–≥—Ä—É–∑–∫–∏
- `ch_host` / `ch_user` / `ch_pass` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ ClickHouse
- `ch_database` / `ch_table` - –∏–º—è –±–∞–∑—ã –∏ —Ç–∞–±–ª–∏—Ü—ã

### 2.1. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º (–µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏)

–ï—Å–ª–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ 400 Bad Request –∏–ª–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:

```bash
python troubleshoot.py --config config.json
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–∞ –∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å—á–µ—Ç—á–∏–∫–∞
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –ø–æ–ª–µ–π –¥–ª—è –≤–∞—à–µ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞

### 3. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse

```bash
python load_ym_to_clickhouse.py --config config.json
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export YM_TOKEN=your_token
export YM_COUNTER_ID=123456
export YM_START_DATE=2024-01-01
export YM_END_DATE=2024-01-31
export CH_HOST=https://clickhouse.example.com:8443
export CH_USER=user
export CH_PASS=password
export CH_DATABASE=analytics
export CH_TABLE=ym_visits

python load_ym_to_clickhouse.py
```

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–≤—ã—Ö 100 —Å—Ç—Ä–æ–∫:

```bash
python query_clickhouse.py --config config.json --table analytics.ym_visits --limit 100
```

–° —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π:

```bash
python query_clickhouse.py --config config.json --table analytics.ym_visits --limit 100 --stats
```

–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:

```bash
python query_clickhouse.py --config config.json --interactive
```

–ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å:

```bash
python query_clickhouse.py --config config.json --query "SELECT date, COUNT(*) as visits FROM analytics.ym_visits GROUP BY date ORDER BY date LIMIT 100"
```

## –ó–∞–≥—Ä—É–∂–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∏

–ü—Ä–æ–≥—Ä–∞–º–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è –¥–ª—è –≤–∞—à–µ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞ –∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏—Ö.

–ù–∞—á–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–∞–µ—Ç 38 –ø–æ–ª–µ–π –¥–ª—è —Ç–∏–ø–∞ –≤—ã–≥—Ä—É–∑–∫–∏ "–≤–∏–∑–∏—Ç—ã":

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π:** –ü—Ä–æ–≥—Ä–∞–º–º–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ–ª—è –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—è –Ø–Ω–¥–µ–∫—Å.–î–∏—Ä–µ–∫—Ç, –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –∫–æ–º–º–µ—Ä—Ü–∏–∏ –∏ —Ç.–¥.). –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫!

- ym:s:visitID - ID –≤–∏–∑–∏—Ç–∞
- ym:s:watchIDs - ID –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
- ym:s:date - –î–∞—Ç–∞
- ym:s:isNewUser - –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- ym:s:startURL - –ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ym:s:endURL - –ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- ym:s:visitDuration - –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∏–∑–∏—Ç–∞
- ym:s:bounce - –û—Ç–∫–∞–∑
- ym:s:clientID - ID –∫–ª–∏–µ–Ω—Ç–∞
- ym:s:goalsID - ID —Ü–µ–ª–µ–π
- ym:s:goalsDateTime - –í—Ä–µ–º—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π
- ym:s:referer - –†–µ—Ñ–µ—Ä–µ—Ä
- ym:s:deviceCategory - –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ym:s:operatingSystemRoot - –û–°
- ym:s:UTMCampaign - UTM –∫–∞–º–ø–∞–Ω–∏—è
- ym:s:UTMContent - UTM —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- ym:s:UTMMedium - UTM –∫–∞–Ω–∞–ª
- ym:s:UTMSource - UTM –∏—Å—Ç–æ—á–Ω–∏–∫
- ym:s:UTMTerm - UTM —Ç–µ—Ä–º–∏–Ω
- ym:s:TrafficSource - –ò—Å—Ç–æ—á–Ω–∏–∫ —Ç—Ä–∞—Ñ–∏–∫–∞
- ym:s:pageViews - –ü—Ä–æ—Å–º–æ—Ç—Ä—ã —Å—Ç—Ä–∞–Ω–∏—Ü
- ym:s:purchaseID - ID –ø–æ–∫—É–ø–∫–∏
- ym:s:purchaseDateTime - –í—Ä–µ–º—è –ø–æ–∫—É–ø–∫–∏
- ym:s:purchaseRevenue - –î–æ—Ö–æ–¥ –æ—Ç –ø–æ–∫—É–ø–∫–∏
- ym:s:purchaseCurrency - –í–∞–ª—é—Ç–∞ –ø–æ–∫—É–ø–∫–∏
- ym:s:purchaseProductQuantity - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
- ym:s:productsPurchaseID - ID –ø–æ–∫—É–ø–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
- ym:s:productsID - ID —Ç–æ–≤–∞—Ä–æ–≤
- ym:s:productsName - –ù–∞–∑–≤–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤
- ym:s:productsCategory - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
- ym:s:regionCity - –ì–æ—Ä–æ–¥
- ym:s:impressionsURL - URL –ø–æ–∫–∞–∑–æ–≤
- ym:s:impressionsDateTime - –í—Ä–µ–º—è –ø–æ–∫–∞–∑–æ–≤
- ym:s:impressionsProductID - ID —Ç–æ–≤–∞—Ä–æ–≤ –≤ –ø–æ–∫–∞–∑–∞—Ö
- ym:s:AdvEngine - –†–µ–∫–ª–∞–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- ym:s:ReferalSource - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫
- ym:s:SearchEngineRoot - –ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
- ym:s:SearchPhrase - –ü–æ–∏—Å–∫–æ–≤–∞—è —Ñ—Ä–∞–∑–∞

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–ü—Ä–æ–≥—Ä–∞–º–º—ã –≤–∫–ª—é—á–∞—é—Ç –ø–æ–ª–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Logs API
- –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ –æ–∂–∏–¥–∞–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `Logs API`
`Logs API` –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–≥—Ä—É–∑–∏—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ —Å—á–µ—Ç—á–∏–∫–∞.

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ `Logs API` - https://yandex.ru/dev/metrika/doc/api2/logs/intro.html

–î–∞–Ω–Ω—ã–µ –¥–ª—è —ç—Ç–æ–≥–æ –∫–µ–π—Å–∞ —Ç–∞–∫–∂–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ - https://disk.yandex.ru/d/sUmQmh_MnQWL4g?w=1

## –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
–î–ª—è —Ä–∞–±–æ—Ç—ã —Å API –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π —Ç–æ–∫–µ–Ω - https://yandex.ru/dev/oauth/doc/dg/tasks/get-oauth-token.html

–°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç—É—Ç (—É–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –≤ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–µ) - https://oauth.yandex.ru/client/new

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –ø–æ —Å—Å—ã–ª–∫–µ –≤–∏–¥–∞ - `https://oauth.yandex.ru/authorize?response_type=token&client_id=<–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è>`

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –¥–æ–º–∞—à–Ω—é—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ —Ñ–∞–π–ª `.yatoken.txt`

# –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞ —Å `–Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞`
–î–ª—è –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –æ—á–Ω–æ–≥–æ —Å–µ–º–∏–Ω–∞—Ä–∞/–≤–æ—Ä–∫—à–æ–ø–∞, –∏–ª–∏, –µ—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –ø–æ –∫–∞–∫–∏–º-—Ç–æ –ø—Ä–∏—á–∏–Ω–∞–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `LogsAPI`, –±—ã–ª–∏ –∑–∞–≥–æ—Ç–æ–≤–ª–¥–µ–Ω—ã CSV —Å –≤—ã–≥—Ä—É–¥–∂–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ `LogsAPI` —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å—á–µ—Ç—á–∏–∫–∞.

–•–∏—Ç—ã: https://disk.yandex.ru/d/MoSoXW6VzAP0bQ
–í–∏–∑–∏—Ç—ã: https://disk.yandex.ru/d/ywvr6YM3B95i0A

–ù—É–∂–Ω–æ —ç—Ç–∏ —Ñ–∞–π–ª—ã —Å–∫–∞—á–∞—Ç—å –∏ –ø–æ–ª–æ–∂–∏—Ç—å –≤ –ø–∞–ø–æ—á–∫—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã.

–í —Ñ–∞–π–ª–µ `some_funcs` –µ—Å—Ç—å –º–µ—Ç–æ–¥, `get_file_from_yadisk(file_link, file_name)` –∫–æ—Ç–æ—Ä—ã–π –∫–æ–ø–∏—Ä—É–µ—Ç —Ä–æ–≤–Ω–æ 1 —Ñ–∞–π–ª –ø–æ —Å—Å—ã–ª–∫–µ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞ `file_link` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –Ω–∞ –¥–∏—Å–∫ –ø–æ –ø—É—Ç–∏ `file_name`

–û–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ, –≤—ã–ø–æ–ª–Ω—è—è —è—á–µ–π–∫–∏ –Ω–∏–∂–µ, –≤—ã –±—É–¥–µ—Ç–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º (`/yandex_metrika_cloud_case`)

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ `ClickHouse`

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
https://cloud.yandex.ru/docs/managed-clickhouse/
(—Å–º. —Å–ª–∞–π–¥—ã)

##  –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å ClickHouse

–í —Ñ–∞–π–ª–µ `some_funcs` –µ—Å—Ç—å –∫–ª–∞—Å—Å `simple_ch_client` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ClickHouse

–°–Ω–∞—á–∞–ª–∞ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–≤ –µ–≥–æ –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ - —Ö–æ—Å—Ç, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä–æ–ª—å –∏ –ø—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É
`simple_ch_client(CH_HOST, CH_USER, CH_PASS, cacert)`

–í –∫–ª–∞—Å—Å–µ –µ—Å—Ç—å 4 –º–µ—Ç–æ–¥–∞:
* `.get_version()` - –ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é ClickHouse. –•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
* `.get_clickhouse_data(query)` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å `query` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
* `.get_clickhouse_df(query)` - –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—Ä–æ—Å `query` –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –≤–∏–¥–µ DataFrame
* `.upload(table, content)` - –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `content`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–∞–µ—Ç—Å—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü—É ClickHouse'–∞ —Å –∏–º–µ–Ω–µ–º `table`


## –ü—Ä–æ–≤–µ—Ä—è–µ–º ClickHouse
–ò—Å–ø–æ–ª—å–∑—É—è –∑–∞–≥–æ–≤–ª–µ–Ω–Ω—ã–µ –≤—ã—à–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∏–º –¥–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ (–∫–∞–∫ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ https://cloud.yandex.ru/docs/managed-clickhouse/operations/connect#connection-string)
–≠—Ç–æ—Ç –º–µ—Ç–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –≤ –º–µ—Ç–æ–¥–µ `.get_version()` –∫–ª–∞—Å—Å–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ClickHouse
–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω–µ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –Ω–∏–∫–∞–∫–æ–π –æ—à–∏–±–∫–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —ç—Ç–æ–≥–æ –º–µ—Ç–æ–¥–∞, –∏ –æ–Ω —Å–∞–º –≤–µ—Ä–Ω–µ—Ç –≤–µ—Ä—Å–∏—é —Å–µ—Ä–≤–µ—Ä–∞ ClickHouse (–Ω–∞–ø—Ä–∏–º–µ—Ä `21.3.2.5`)
